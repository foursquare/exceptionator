<html>
<head>
    <title>Exceptionator</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/content/bootstrap.min.css">
    <link rel="stylesheet" href="/content/exceptionator.css">
    <script src="/content/date-en-US.js" type="text/javascript"></script>
    <script src="/content/json2.js" type="text/javascript"></script>
    <script src="/content/jquery.min.js" type="text/javascript"></script>
    <script src="/content/jquery.flot.js" type="text/javascript"></script>
    <script src="/content/jquery.flot.time.js" type="text/javascript"></script>
    <script src="/content/soyutils.js" type="text/javascript"></script>
    <script src="/content/underscore.js" type="text/javascript"></script>
    <script src="/content/backbone.js" type="text/javascript"></script>
    <script src="/content/exceptionator.backbone.js" type="text/javascript"></script>
    <script src="/content/exceptionator.soy.js" type="text/javascript"></script>

</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="container-fluid">
        <a class="brand" id="topbar_title">Exceptionator</a>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="content">
      <div style="height:60px">
      </div>
      <div class="row">
        <div class="span9">
          <input id="query" name="query" type="text" />
        </div>
        <div class="span5"> results/bucket:
          <select id="listSize" style="width:auto">
            <option value="5">5</option>
            <option selected="selected" value="10">10</option>
            <option value="15">15</option>
            <option value="30">30</option>
            <option value="60">60</option>
          </select>
          graph:
          <select id="graphSpan" style="width:auto">
            <option value="hour" selected="selected">hour</option>
            <option value="day">day</option>
            <option value="month">month</option>
          </select>
        </div>
      </div>
      <div id="notice_buckets">
      </div>
      <footer>
        <p>&copy; foursquare 2012</p>
      </footer>
    </div>
  </div>
  <script type='text/javascript'>
  $(function(){

    $('#graphSpan').change(function() {
      Exceptionator.GraphSpan = $(this).val();
    });

    $('#listSize').change(function() {
      Exceptionator.Limit = +$(this).val();
    });

    $('#topbar_title').click(function() {
      Exceptionator.Router.navigate('/', {trigger:true});
    });

    $('body').keyup(function(event) {
      if(event.keyCode == 80) {
        if (Exceptionator.Paused) {
          Exceptionator.Paused = false;
        } else {
          Exceptionator.Paused = true;
        }
        var title = (Exceptionator.Paused ? '[Paused] ' : '') + 'Exceptionator';
        document.title = title;
        $('#topbar_title').text(title);
      }
    });

    $('#query').keyup(function(event) {
      event.stopImmediatePropagation();
      if(event.keyCode == 13) {
        Exceptionator.Router.navigate('search/?q=' +  $('#query').val(), {trigger: true});
      }
    });

    $.get('/api/config', function(data) {
      Exceptionator.Config = data;
      Exceptionator.App = new Exceptionator.AppView({el: $('#notice_buckets')});
      Exceptionator.Router = new Exceptionator.Routing({app: Exceptionator.App});
      Backbone.history.start({pushState: true});

      looper = function() {
        Exceptionator.LoopTimer = setTimeout(function(){
          if (!Exceptionator.Paused) {
            Exceptionator.App.fetch();
          }
          looper();
        }, 1000);
      }
      looper();
    });

  });
  </script>
</body>
</html>
